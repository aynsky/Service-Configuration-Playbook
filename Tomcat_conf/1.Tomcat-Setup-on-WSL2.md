# Tomcat Setup on WSL2 (RHEL 9) – Quick Start Guide 🚀

This guide shows how to **install and run Tomcat 10 on WSL2** with RHEL 9, including common issues and how to solve them.

---

## 📋 Table of Contents
- [Download Tomcat](#1️⃣-download-tomcat)
- [Environment Variables](#2️⃣-environment-variables)
- [Start and Stop Tomcat](#3️⃣-start-and-stop-tomcat)
- [Configure Admin Users](#4️⃣-configure-admin-users)
- [Common Challenges](#5️⃣-common-challenges)
- [Folder Structure Overview](#6️⃣-folder-structure-overview)

---

## 1️⃣ Download Tomcat

```bash
cd /opt
sudo wget https://downloads.apache.org/tomcat/tomcat-10/v10.1.46/bin/apache-tomcat-10.1.46.zip
sudo unzip apache-tomcat-10.1.46.zip
sudo mv apache-tomcat-10.1.46 tomcat10
sudo chmod +x tomcat10/bin/*.sh
```

> ✅ **Note:** We verified the URL from the official Apache mirror.
> 
> 💡 **Tip:** WSL2 doesn't have systemd, so we **cannot use** `systemctl start tomcat`.

---

## 2️⃣ Environment Variables

```bash
export CATALINA_HOME=/opt/tomcat10
export PATH=$PATH:$CATALINA_HOME/bin
source ~/.bashrc
```

**What these do:**
- `$CATALINA_HOME` → tells Tomcat scripts where the installation is
- Adding `$CATALINA_HOME/bin` to `PATH` allows running scripts from anywhere
- On real servers, this is usually handled in a service unit or environment file

---

## 3️⃣ Start and Stop Tomcat

```bash
# Start Tomcat
$CATALINA_HOME/bin/startup.sh

# Stop Tomcat
$CATALINA_HOME/bin/shutdown.sh
```

- 🌐 Tomcat starts and listens on **http://localhost:8080/**
- 📋 Logs are in `$CATALINA_HOME/logs/catalina.out`

---

## 4️⃣ Configure Admin Users

To access Tomcat's web management interface, you need to configure admin users in `tomcat-users.xml`.

### Step 1: Edit tomcat-users.xml

```bash
sudo nano $CATALINA_HOME/conf/tomcat-users.xml
```

### Step 2: Add Admin Users

Replace the content between `<tomcat-users>` tags with:

```xml
<tomcat-users xmlns="http://tomcat.apache.org/xml"
              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              xsi:schemaLocation="http://tomcat.apache.org/xml tomcat-users.xsd"
              version="1.0">
<!--
  Define roles for Tomcat management
-->
  <role rolename="manager-gui"/>
  <role rolename="manager-script"/>
  <role rolename="manager-jmx"/>
  <role rolename="manager-status"/>
  <role rolename="admin-gui"/>
  <role rolename="admin-script"/>

<!--
  Define users with their roles
-->
  <user username="admin" 
        password="admin123" 
        roles="manager-gui,manager-script,manager-jmx,manager-status,admin-gui,admin-script"/>
  
  <user username="manager" 
        password="manager123" 
        roles="manager-gui,manager-status"/>
        
</tomcat-users>
```

### Step 3: Configure Remote Access (Optional)

By default, Tomcat Manager is only accessible from localhost. To access from other machines:

```bash
# Edit Manager app context
sudo nano $CATALINA_HOME/webapps/manager/META-INF/context.xml
```

Comment out the Valve restriction:

```xml
<Context antiResourceLocking="false" privileged="true" >
  <CookieProcessor className="org.apache.tomcat.util.http.Rfc6265CookieProcessor"
                   sameSiteCookies="strict" />
<!--
  <Valve className="org.apache.catalina.valves.RemoteAddrValve"
         allow="127\.\d+\.\d+\.\d+|::1|0:0:0:0:0:0:0:1" />
-->
</Context>
```

### Step 4: Restart Tomcat

```bash
$CATALINA_HOME/bin/shutdown.sh
$CATALINA_HOME/bin/startup.sh
```

### Step 5: Access Management Interface

- **Tomcat Manager:** `http://localhost:8080/manager/html`
- **Host Manager:** `http://localhost:8080/host-manager/html`
- Login with: `admin` / `admin123`

### User Roles Explained

| Role | Description |
|------|-------------|
| `manager-gui` | Access to HTML manager interface |
| `manager-script` | Access to text-based manager interface |
| `manager-jmx` | Access to JMX proxy interface |
| `manager-status` | Access to read-only status page |
| `admin-gui` | Access to HTML host manager interface |
| `admin-script` | Access to text-based host manager interface |

> ⚠️ **Security Warning:** Change default passwords in production environments!

---

## 5️⃣ Common Challenges

### 1. `systemctl` doesn't work in WSL2
**Problem:** Standard systemd commands fail  
**Solution:** Use `startup.sh` and `shutdown.sh` instead

### 2. History expansion with `!` in Bash
**Problem:** When using `echo "<h1>Hello!</h1>"`, Bash throws `event not found`  
**Solution:** Use single quotes: `echo '<h1>Hello!</h1>' > index.html`

### 3. DNF install gives older Tomcat
**Problem:** Package managers often have outdated versions (Tomcat 9 vs Tomcat 10)  
**Solution:** For latest features, manual download is better

### 4. Access Denied to Manager App
**Problem:** Cannot access Tomcat Manager interface  
**Solutions:**
- Verify users are configured in `tomcat-users.xml`
- Check if remote access valve is blocking connections
- Ensure Tomcat has been restarted after configuration changes

### 5. Permission Issues
**Problem:** Cannot edit configuration files  
**Solution:** Use `sudo` when editing files in `/opt/tomcat10/`

---

## 6️⃣ Folder Structure Overview

```
$CATALINA_HOME/
├── bin/      # Scripts to start/stop
├── conf/     # server.xml, web.xml, users, configs
│   ├── tomcat-users.xml    # User accounts and roles
│   ├── server.xml          # Server configuration  
│   └── web.xml             # Default web app config
├── lib/      # Shared libraries (servlet-api.jar)
├── logs/     # Tomcat logs
│   └── catalina.out        # Main log file
├── webapps/  # Your deployed apps
│   ├── manager/            # Tomcat Manager app
│   ├── host-manager/       # Host Manager app
│   └── ROOT/              # Default web app
├── temp/     # Temp files
└── work/     # Compiled JSPs
```

**Key directories:**
- `webapps/` → where we deploy HTML or servlet apps
- `conf/tomcat-users.xml` → define admin/manager users
- `logs/catalina.out` → main application log file

---

## 🔧 Quick Setup Verification

After completing the setup, verify everything works:

1. **Check Tomcat is running:**
   ```bash
   curl http://localhost:8080
   ```

2. **View logs:**
   ```bash
   tail -f $CATALINA_HOME/logs/catalina.out
   ```

3. **Test Manager access:**
   - Visit `http://localhost:8080/manager/html`
   - Login with your admin credentials

---

## 🔗 Additional Resources

- [Official Tomcat Documentation](https://tomcat.apache.org/tomcat-10.1-doc/)
- [Apache Tomcat Downloads](https://tomcat.apache.org/download-10.cgi)
- [Tomcat Manager App HOW-TO](https://tomcat.apache.org/tomcat-10.1-doc/manager-howto.html)

---

## 📝 Notes

This guide is specifically tailored for WSL2 environments where traditional Linux service management isn't available. For production deployments, consider using proper systemd service files or containerization.
# Tomcat 10 on Real Linux Servers ‚Äì Production Setup Guide üè¢

This guide explains **how Tomcat 10 is deployed and managed on a real server**, highlighting differences from WSL2 practice setups.

---

## üìã Table of Contents
- [Installation & Users](#1Ô∏è‚É£-installation--users)
- [Environment Variables](#2Ô∏è‚É£-environment-variables)
- [Start/Stop Tomcat](#3Ô∏è‚É£-startstop-tomcat)
- [Users & Security](#4Ô∏è‚É£-users--security)
- [Deploying Apps](#5Ô∏è‚É£-deploying-apps)
- [Key Differences from WSL2 Practice](#6Ô∏è‚É£-key-differences-from-wsl2-practice)
- [Production Tips](#7Ô∏è‚É£-production-tips)

---

## 1Ô∏è‚É£ Installation & Users

On a real server, **we usually don't download to `/opt` manually**. Tomcat is often installed via package manager (yum/dnf) or manually for latest versions.

### Typical Installation Paths

```
/usr/share/tomcat10    # Tomcat binaries
/var/lib/tomcat10      # Webapps, deployed apps  
/var/log/tomcat10      # Logs
/etc/tomcat10          # Configuration files
```

### Creating a Dedicated Tomcat User

Tomcat typically runs as its own **system user**, e.g., `tomcat`. **Avoid running as root** for security reasons.

```bash
sudo useradd -r -m -U -d /opt/tomcat10 -s /bin/false tomcat
```

**Options explained:**
- `-r` ‚Üí system account
- `-m` ‚Üí create home directory
- `-U` ‚Üí create group with same name
- `-s /bin/false` ‚Üí no shell login (security)

---

## 2Ô∏è‚É£ Environment Variables

- `$CATALINA_HOME` and `$CATALINA_BASE` are usually defined in `/etc/default/tomcat10` or in the systemd service file
- **No need to export manually every session**

### Example Systemd Unit Snippet

```ini
[Unit]
Description=Apache Tomcat Web Application Container
After=network.target

[Service]
Type=forking
User=tomcat
Group=tomcat
Environment="CATALINA_HOME=/usr/share/tomcat10"
Environment="CATALINA_BASE=/var/lib/tomcat10"
Environment="CATALINA_PID=/var/run/tomcat10.pid"
Environment="JAVA_OPTS=-Djava.awt.headless=true -Djava.security.egd=file:/dev/./urandom"

ExecStart=/usr/share/tomcat10/bin/startup.sh
ExecStop=/usr/share/tomcat10/bin/shutdown.sh

[Install]
WantedBy=multi-user.target
```

---

## 3Ô∏è‚É£ Start/Stop Tomcat

Real servers use **systemd** for service management:

```bash
# Start Tomcat
sudo systemctl start tomcat

# Stop Tomcat  
sudo systemctl stop tomcat

# Check status
sudo systemctl status tomcat

# Enable auto-start on boot
sudo systemctl enable tomcat

# Restart Tomcat
sudo systemctl restart tomcat
```

### Centralized Logs

- `/var/log/tomcat10/catalina.out` ‚Üí main application log
- `/var/log/tomcat10/localhost_access_log.*.txt` ‚Üí access logs

---

## 4Ô∏è‚É£ Users & Security

Admin and Manager users are defined in `tomcat-users.xml`:

```xml
<?xml version="1.0" encoding="UTF-8"?>
<tomcat-users xmlns="http://tomcat.apache.org/xml"
              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              xsi:schemaLocation="http://tomcat.apache.org/xml tomcat-users.xsd"
              version="1.0">

    <!-- Define roles -->
    <role rolename="manager-gui"/>
    <role rolename="admin-gui"/>
    <role rolename="manager-script"/>
    
    <!-- Define users with roles -->
    <user username="admin" 
          password="StrongPassword123!" 
          roles="manager-gui,admin-gui"/>
    
    <user username="deployer" 
          password="AnotherStrongPass456!" 
          roles="manager-script"/>
</tomcat-users>
```

### Security Best Practices

- ‚úÖ Use **strong passwords**
- ‚úÖ Avoid giving all-powerful roles to one user  
- ‚úÖ Separate users for different purposes:
  - `manager-gui` ‚Üí web management interface
  - `admin-gui` ‚Üí host manager
  - `manager-script` ‚Üí script-based deployment
- ‚úÖ Consider firewall rules and reverse proxy

---

## 5Ô∏è‚É£ Deploying Apps

### Preferred Deployment Methods in Production

#### 1. WAR File Deployment
```bash
# Copy WAR file to webapps directory
sudo cp myapp.war $CATALINA_BASE/webapps/
# Tomcat auto-deploys on restart or hot-deploy (if enabled)
```

#### 2. Separate CATALINA_BASE Instances
- Multiple Tomcat instances from one installation
- Each instance has its own `webapps/`, `logs/`, `conf/`

```bash
# Example structure
/var/lib/tomcat-instance1/
‚îú‚îÄ‚îÄ conf/
‚îú‚îÄ‚îÄ webapps/
‚îî‚îÄ‚îÄ logs/

/var/lib/tomcat-instance2/  
‚îú‚îÄ‚îÄ conf/
‚îú‚îÄ‚îÄ webapps/
‚îî‚îÄ‚îÄ logs/
```

#### 3. Annotations Over web.xml
Modern servlets use annotations to reduce configuration:

```java
import jakarta.servlet.annotation.WebServlet;
import jakarta.servlet.http.HttpServlet;

@WebServlet("/hello")
public class HelloServlet extends HttpServlet {
    // Servlet implementation
}
```

**Benefits:**
- Reduces configuration errors
- Simplifies deployment
- No need for complex `web.xml` mappings

---

## 6Ô∏è‚É£ Key Differences from WSL2 Practice

| Aspect | WSL2 Practice | Real Server |
|--------|---------------|-------------|
| **Tomcat path** | `/opt/tomcat10` | `/usr/share/tomcat10` (binaries)<br>`/var/lib/tomcat10` (apps) |
| **Service control** | `startup.sh` / `shutdown.sh` | `systemctl start/stop/status tomcat` |
| **User** | Root or current user | Dedicated `tomcat` user |
| **Security** | Minimal, local | Strong passwords, roles, SELinux/AppArmor |
| **Deployment** | Manual `.class` or HTML in webapps | WAR files, multiple instances, annotation-based servlets |
| **Logs** | `$CATALINA_HOME/logs/` | `/var/log/tomcat10/` |
| **Configuration** | Manual environment exports | systemd service files, `/etc/default/tomcat10` |

---

## 7Ô∏è‚É£ Production Tips

### Security & Maintenance

1. **Always run Tomcat under a non-root user**
   ```bash
   # Verify Tomcat is not running as root
   ps aux | grep tomcat
   ```

2. **Keep webapps, logs, and temp directories separate** from binaries
   - Easier backups and updates
   - Better security isolation

3. **Use firewalls / reverse proxy** (NGINX, Apache) in front of Tomcat
   ```nginx
   # Example NGINX proxy configuration
   location / {
       proxy_pass http://localhost:8080;
       proxy_set_header Host $host;
       proxy_set_header X-Real-IP $remote_addr;
   }
   ```

4. **Regularly monitor logs** in `/var/log/tomcat10`
   ```bash
   # Monitor catalina.out in real-time
   sudo tail -f /var/log/tomcat10/catalina.out
   ```

5. **Use systemd** to ensure Tomcat restarts automatically on server reboot
   ```bash
   sudo systemctl enable tomcat
   ```

### Performance & Monitoring

- Configure JVM heap size appropriately
- Set up log rotation for Tomcat logs  
- Monitor resource usage (CPU, memory, disk)
- Implement health checks for load balancers
- Consider using APM tools for application monitoring

---

## üîß Quick Production Checklist

- [ ] Tomcat running as dedicated user (not root)
- [ ] systemd service configured and enabled
- [ ] Strong passwords in tomcat-users.xml
- [ ] Firewall rules configured
- [ ] Log rotation set up
- [ ] Regular security updates scheduled
- [ ] Backup strategy for webapps and configurations
- [ ] Monitoring and alerting configured

---

## üìö Additional Resources

- [Tomcat Security Guide](https://tomcat.apache.org/tomcat-10.1-doc/security-howto.html)
- [systemd Service Files](https://www.freedesktop.org/software/systemd/man/systemd.service.html)
- [Linux Security Best Practices](https://linux-audit.com/linux-server-hardening-most-important-steps-to-secure-systems/)

---

## üöÄ Next Steps

After setting up Tomcat in production:
- Learn about clustering for high availability
- Explore containerization with Docker
- Set up CI/CD pipelines for automated deployment
- Implement comprehensive logging and monitoring